jQuery(document).ready((function(e){"use strict";var t=e("#add-new"),i=e("#add-new-name"),n=e("#ywccp_field_add_edit_form"),a=e("#ywccp_checkout_fields"),d=function(t,i,n,a,d){if(t.attr("data-row",a),t.attr("data-action",n),!d){var o=t.find("tr.remove_default");o.length&&o.remove()}t.find('select[name^="field_type"]').on("change",(function(){var i=t.find("tr[data-hide]"),n=e(this).val();i.length&&e.each(i,(function(){var t=e(this).data("hide").split(",");e.inArray(n,t)>-1?e(this).hide():e(this).show()}))})).trigger("change"),t.dialog({title:i,modal:!0,width:900,resizable:!1,autoOpen:!1,buttons:[{text:"Save",click:function(){e.edit_add_field(this)&&e(this).dialog("close")}}],close:function(e,i){t.dialog("destroy"),t.remove()}})},o=function(e){var t=a.data("prepend");return e=(e=Array.isArray(e)?e[0].value:e.trim()).replace(/\s/g,"_"),""!=t&&-1===e.indexOf(t)&&(e=t+e),e};i.on("focus",(function(){e(this).removeClass("required field-exists")})),t.on("click",(function(){var e=i.val();if(""==e)return i.addClass("required"),!1;if(e=o(e),a.find('input.field_name[value="'+e+'"]').length)return i.addClass("field-exists"),!1;var t=n.clone();d(t,ywccp_admin.popup_add_title,"add","",!0),t.find('input[name="field_name[]"]').val(e),t.dialog("open")})),e(document).on("click","button.edit_field",(function(){var t=e(this).closest("tr"),i=t.data("row"),a=t.find('input[type="hidden"]'),o=n.clone(),s=t.find('input[type="hidden"][name="field_condition_input_name[]"]');o=f(s,o),e.each(a,(function(t,i){var n=e(i).data("name"),a=o.find('td *[name="'+n+'[]"]');if(e(this).hasClass("condition"))for(var d=e(i).val().split("|"),s=d.length,c=0;c<s;c++)"checkbox"==(a=o.find('td *[name="'+n+'[]"]').eq(c)).attr("type")?l(a,d[c]):a.val(d[c]);else if("checkbox"==a.attr("type")){var r=e(i).val();l(a,r)}else a.val(e(i).val())})),d(o,ywccp_admin.popup_edit_title,"edit",i,t.hasClass("is_custom")),o.dialog("open")}));var l=function(e,t){0==t?e.removeAttr("checked"):e.attr("checked","checked")};e.edit_add_field=function(t){var i,n,d=a.find("tbody tr"),l=e(t).data("action");if("edit"==l?(n=e(t).data("row"),i=d.filter('[data-row="'+n+'"]')):(i=d.last().clone(),n=d.size(),i.attr("data-row",n),i.removeClass("disabled-row").addClass("is_custom"),i.find('input[data-name="field_enabled"]').val("1")),e.each(i.find('input[type="hidden"]'),(function(n,a){var d=e(a).data("name"),l=e(t).find('td *[name="'+d+'[]"]'),s="",c="";if(l.length){if("checkbox"==l.attr("type"))if(l.hasClass("condition-field"))for(var f=0;f<l.length;f++)c=c+(s=l[f].checked?1:0)+"|";else c=1==(s=l.is(":checked")?1:0)?ywccp_admin.enabled:"";else s=l.serializeArray(),c="field_name"==d?o(s):r(s);e(a).val(c),i.find(".td_"+d).html(c)}else e(a).hasClass("condition")&&e(a).val("")})),"add"==l&&(d.last().after(i),void 0!==e.fn.tipTip)){i.find(".tips").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200})}return!0},e(".check-column input").on("change",(function(){e(this);var t=e("td.td_select input");e(this).is(":checked")?t.attr("checked","checked"):t.removeAttr("checked")})),e(document).on("click","button.enable_field",(function(){var t,i=e(this),n=i.closest("tr"),a=n.find('input[data-name="field_enabled"]');n.toggleClass("disabled-row"),a.length&&a.val(n.hasClass("disabled-row")?"0":"1"),t=i.html(),i.html(i.data("label")),i.data("label",t)}));e(document).on("click","button.remove_field",(function(){var t=e(this).closest("tr");t.hasClass("is_custom")&&confirm(ywccp_admin.deleteConfirm)&&t.fadeOut(400,(function(){t.addClass("disabled-row").hide(),t.find('input[data-name="field_deleted"]').val("yes")}))}));var s=e(".ywccp_multiselect_admin"),c=e(".ywccp_datepicker_admin");s&&e.each(s,(function(){var t=e(this),i=t.data("value").split(", ");t.after('<input type="hidden" name="'+t.attr("name")+'" value>'),t.on("change",(function(){var t=e(this).val();t=t?t.join(", "):"",e(this).next().val(t)})),t.val(i).trigger("change"),void 0!==e.fn.select2&&t.select2()})),void 0!==e.fn.datepicker&&c&&e.each(c,(function(){e(this).datepicker({dateFormat:e(this).data("format")||"dd-mm-yy"})})),e(document).on("click",".add-new",(function(t){t.preventDefault();var i=e(this).closest(".single-condition"),n=jQuery(i).clone();n.find(".condition-field").val("").prop("disabled",!1).prop("checked",!1).removeClass("disabled"),i.after(n)})),e(document).on("click",".remove",(function(t){t.preventDefault(),e(this).closest(".single-condition").remove()}));var r=function(e){var t,i=e.length,n="";for(t=0;t<i;t++)0!=t&&(n+="|"),n+=e[t].value;return n},f=function(e,t){for(var i=e[0].value.split("|").length,n=t.find("table.wrap-conditions"),a=1;a<i;a++){t.find(".single-condition").eq(0).clone().appendTo(n)}return t};e(document).on("change","select.field_condition_input_name",(function(t){"products"==e(this).val()?(e(this).closest(".single-condition").find("select.condition-type").find('option[value="is-set"]').attr("disabled","disabled"),e(this).closest(".single-condition").find("select.condition-type").find('option[value="is-empty"]').attr("disabled","disabled"),e(this).closest(".single-condition").find("select.condition-type").find('option[value="has-value"]').attr("disabled","disabled"),e(this).closest(".single-condition").find("select.condition-type").find('option[value="all-in-cart"]').removeAttr("disabled"),e(this).closest(".single-condition").find("select.condition-type").find('option[value="at-least-one-in-cart"]').removeAttr("disabled")):(e(this).closest(".single-condition").find("select.condition-type").find('option[value="is-set"]').removeAttr("disabled"),e(this).closest(".single-condition").find("select.condition-type").find('option[value="is-empty"]').removeAttr("disabled"),e(this).closest(".single-condition").find("select.condition-type").find('option[value="has-value"]').removeAttr("disabled"),e(this).closest(".single-condition").find("select.condition-type").find('option[value="all-in-cart"]').attr("disabled","disabled"),e(this).closest(".single-condition").find("select.condition-type").find('option[value="at-least-one-in-cart"]').attr("disabled","disabled"))})),e(document).on("change","select.condition-type",(function(t){"is-set"==e(this).val()||"is-empty"==e(this).val()?e(this).closest(".single-condition").find("input.field_condition_value").addClass("disabled"):e(this).closest(".single-condition").find("input.field_condition_value").removeClass("disabled")})),e(document).find(".ui-sortable").sortable({cursor:"move",axis:"y",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",stop:function(t,i){var n=jQuery(".ui-sortable-handle"),a=0,d=new Array;for(a=0;a<n.length;a++)d[a]=e(n[a]).data("item_key")}})}));